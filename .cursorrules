# ğŸ¯ TripMaker (Waypoint) - Cursor AI Master Rules

> **Last Updated:** January 31, 2026 (doc cleanup)  
> **Version:** 3.0.0  
> **Status:** MVP1 In Development ğŸš§ (See MVP_ROADMAP.md for details)

---

## ğŸ¯ CRITICAL: MVP DEVELOPMENT RULES

### ğŸ“‹ Current MVP Phase: MVP1 - Trip Planning Foundation
**READ FIRST:** See `MVP_ROADMAP.md` for complete phase breakdown  
**Tasks:** See `MVP1_TASK_BREAKDOWN.md` for atomic tasks  
**Progress:** 25% complete (Auth + Profile done)  
**Current Sprint:** Trip Persistence (CRUD operations)

### ğŸš¨ MANDATORY RULES FOR ALL DEVELOPMENT

#### Rule 1: Documentation Updates (CRITICAL)
**Update these files with EVERY code change:**

1. **`MVP_ROADMAP.md`** - Update feature completion status âœ…
   - Mark features as complete when done
   - Update progress percentages
   - Update "Last Updated" timestamp
   - Add to decision log if needed

2. **`MVP1_TASK_BREAKDOWN.md`** - Update task completion
   - Check off completed tasks
   - Update sprint timeline
   - Mark any blockers

3. **`API_REFERENCE.md`** - Update for API changes
   - Document new endpoints immediately
   - Include request/response examples
   - Update table of contents

4. **`APP_ARCHITECTURE.md`** - Update for data model changes
   - Update data flow diagrams (text-based)
   - Document new storage structures
   - Explain architectural decisions

**BEFORE making ANY code change:**
- âœ… Read relevant section in MVP_PLAN.md
- âœ… Check DEVELOPMENT_STATUS.md for current focus
- âœ… Understand the task's acceptance criteria

**AFTER completing ANY task:**
- âœ… Update MVP_PLAN.md task checkbox
- âœ… Update DEVELOPMENT_STATUS.md with completion
- âœ… Update API_REFERENCE.md if API changed
- âœ… Update APP_ARCHITECTURE.md if data model changed
- âœ… **Verify in browser:** Run the app, exercise the changed flow in a real browser (see `MVP1_BROWSER_TEST_CHECKLIST.md` for flows). Do not mark the task complete until the feature works correctly in browser view.
- âœ… Commit with clear message referencing task number

#### Rule 2: Scope Management (CRITICAL)
**NEVER go outside current MVP phase unless explicitly requested.**

âœ… **ALLOWED:**
- Implementing tasks in current MVP phase (MVP1)
- Fixing bugs in already-completed features
- Improving documentation
- Refactoring code within current scope

âŒ **FORBIDDEN:**
- Adding MVP2/MVP3/MVP4/MVP5 features
- Adding "nice to have" features not in MVP_PLAN.md
- Implementing features from other phases
- Adding external dependencies not in plan
- Changing tech stack or architecture

**If user requests out-of-scope feature:**
1. âš ï¸ Politely inform them it's in a future MVP phase
2. ğŸ“‹ Reference the specific phase in MVP_PLAN.md
3. âœ… Ask if they want to reprioritize (move to current phase)
4. ğŸ“ Document the decision in DEVELOPMENT_STATUS.md

#### Rule 3: Demo-Ready State (CRITICAL)
**App must be demo-ready after EVERY commit.**

âœ… **Before committing:**
- Test feature works locally (both dev and build)
- **Verify in browser:** Open the app in a browser and confirm the changed/affected flows work (see `MVP1_BROWSER_TEST_CHECKLIST.md`). Ensures no regressions (e.g. one-character input bug, broken forms).
- No console errors or warnings
- All existing features still work
- Documentation updated
- Code follows existing patterns

âŒ **Never commit:**
- Broken features
- Half-implemented functionality
- Code that crashes the app
- Changes that break existing features
- Uncommitted configuration changes

**Transaction-Based Development:**
- Either complete entire task OR don't start it
- Use feature flags for large changes
- Test rollback if uncertain
- Keep commits atomic and focused

#### Rule 4: Current Phase Awareness
**Always know exactly where we are in the plan.**

**Before starting work, answer:**
1. What MVP phase are we in? (Check MVP_PLAN.md header)
2. What is current sprint goal? (Check DEVELOPMENT_STATUS.md)
3. What task am I working on? (Check task number)
4. What are acceptance criteria? (Check task description)
5. What files need updating? (Check "After completing" checklist)

**Current Phase Context:**
- **MVP Phase:** MVP3 - Real-Time Trip Execution (ready to start)
- **MVP1:** 100% complete
- **MVP2:** 100% complete (feed, sharing, invite codes, collaborators)
- **Current Sprint:** MVP3 task breakdown and first deliverables
- **Blocked Features:** MVP4-5 until MVP3 complete
- **Browser verification:** Required after each task â€” see `MVP1_BROWSER_TEST_CHECKLIST.md`

---

## ğŸ“– QUICK REFERENCE

### Essential Documentation (READ FIRST)
- **`MVP_PLAN.md`** - â­ **START HERE** - Complete feature breakdown, tasks, phases
- **`DEVELOPMENT_STATUS.md`** - â­ **CHECK DAILY** - Current sprint, progress, blockers
- **`MVP1_BROWSER_TEST_CHECKLIST.md`** - â­ **VERIFY IN BROWSER** - Manual browser test flows after each task
- **`APP_ARCHITECTURE.md`** - Complete system architecture, data flow, security
- **`API_REFERENCE.md`** - All API endpoints, request/response formats
- **`README.md`** - Project overview and quick start

### Documentation Update Priority
1. **MVP_PLAN.md** - Update task status (every task completion)
2. **DEVELOPMENT_STATUS.md** - Update daily progress (end of day)
3. **API_REFERENCE.md** - Update for new endpoints (immediately)
4. **APP_ARCHITECTURE.md** - Update for data changes (immediately)

### Production URLs (Render)
- **Frontend**: your Render static site or web service URL
- **API**: your Render backend service URL (e.g. https://your-backend.onrender.com)
- **Repository**: https://github.com/avinash6982/TripMakerWeb

---

## ğŸ¯ CRITICAL: Development Test User

**FOR ALL DEVELOPMENT, TESTING, AND CURSOR AGENT WORK:**

```
Email:    dev@tripmaker.com
Password: DevUser123!
ID:       dev-user-00000000-0000-0000-0000-000000000001
```

**Why This User?**
- âœ… Auto-seeded on every API call
- âœ… Available in local AND deployed environments
- âœ… Consistent ID for predictable testing
- âœ… Never gets deleted (ephemeral storage workaround)

**ALWAYS use this user. NEVER create new test users unless explicitly asked.**

---

## ğŸ—ï¸ PROJECT OVERVIEW

**TripMaker** (branded as "Waypoint") is a production-ready trip planning platform.

### Technology Stack
| Layer | Technology |
|-------|------------|
| **Frontend** | React 19.2.3 + Vite 7.3.1 + React Router 7.12.0 |
| **Backend** | Express.js 5.2.1 + JWT + Swagger |
| **i18n** | i18next (6 languages: en, hi, ml, ar, es, de) |
| **Deployment** | Render (backend + static frontend) |
| **Monorepo** | npm workspaces |

### Architecture Pattern
```
Monorepo (npm workspaces)
â”œâ”€â”€ apps/frontend/     â†’ React/Vite SPA
â”œâ”€â”€ apps/backend/      â†’ Express.js API (local dev)
â””â”€â”€ api/               â†’ Optional serverless entry (project uses Render; backend = apps/backend)
```

## ğŸ“ MONOREPO STRUCTURE

```
TripMaker/                                   # Root (monorepo workspace)
â”œâ”€â”€ apps/
â”‚   â”œâ”€â”€ frontend/                            # @tripmaker/frontend - React/Vite
â”‚   â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”‚   â”œâ”€â”€ pages/                      # Page components
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Home.jsx                # Authenticated home page
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Login.jsx               # Login page
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Register.jsx            # Registration page
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ Profile.jsx             # User profile management
â”‚   â”‚   â”‚   â”œâ”€â”€ layouts/                    # Layout wrappers
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ AuthLayout.jsx          # For login/register
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ SiteLayout.jsx          # For authenticated pages
â”‚   â”‚   â”‚   â”œâ”€â”€ services/                   # API communication layer
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ auth.js                 # Auth API (register, login)
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ profile.js              # Profile API (get, update)
â”‚   â”‚   â”‚   â”œâ”€â”€ App.jsx                     # Main app + routing
â”‚   â”‚   â”‚   â”œâ”€â”€ main.jsx                    # React entry point
â”‚   â”‚   â”‚   â”œâ”€â”€ i18n.js                     # i18n config (6 languages)
â”‚   â”‚   â”‚   â””â”€â”€ index.css                   # Global styles
â”‚   â”‚   â”œâ”€â”€ .env.development                # Local dev config (VITE_API_URL)
â”‚   â”‚   â”œâ”€â”€ vite.config.js                  # Vite config
â”‚   â”‚   â””â”€â”€ package.json                    # Frontend dependencies
â”‚   â”‚
â”‚   â””â”€â”€ backend/                             # @tripmaker/backend - Express.js
â”‚       â”œâ”€â”€ server.js                        # Monolithic Express app (local dev)
â”‚       â”‚                                    # Contains: all routes, middleware, logic
â”‚       â”œâ”€â”€ data/users.json                  # Local user storage (persistent)
â”‚       â”œâ”€â”€ .env.development                 # Local dev config (loaded when NODE_ENV=development or .env missing; no .env required)
â”‚       â””â”€â”€ package.json                     # Backend dependencies
â”‚
â”œâ”€â”€ api/                                     # Optional serverless (project deploys on Render)
â”‚   â”œâ”€â”€ index.js                            # API root
â”‚   â”œâ”€â”€ health.js                           # Health check endpoint
â”‚   â”œâ”€â”€ auth/
â”‚   â”‚   â”œâ”€â”€ register.js                     # User registration
â”‚   â”‚   â””â”€â”€ login.js                        # User authentication
â”‚   â”œâ”€â”€ user/
â”‚   â”‚   â””â”€â”€ profile.js                      # Profile GET/PUT
â”‚   â””â”€â”€ lib/                                # Shared utilities
â”‚       â”œâ”€â”€ db.js                           # Database functions
â”‚       â””â”€â”€ seedUser.js                     # Auto-seed dev user
â”‚
â”œâ”€â”€ APP_ARCHITECTURE.md                     # â­ Complete architecture guide
â”œâ”€â”€ API_REFERENCE.md                        # â­ All API endpoints
â”œâ”€â”€ PROFILE_TESTING_RESULTS.md              # Testing results
â”œâ”€â”€ README.md                               # Project overview
â”œâ”€â”€ QUICK_START.md                          # 2-minute local setup
â”œâ”€â”€ DEVELOPMENT_QUICKSTART.md               # Daily dev workflow
â”œâ”€â”€ DEV_USER_GUIDE.md                       # Dev user documentation
â”œâ”€â”€ TEST_USER.md                            # Test user credentials
â”œâ”€â”€ DOCUMENTATION_INDEX.md                  # Documentation map
â””â”€â”€ RENDER_DEPLOYMENT_GUIDE.md              # Deployment (Render only)
â”‚
â”œâ”€â”€ .cursorrules                             # â­ THIS FILE (Cursor AI guide)
â”œâ”€â”€ .gitignore                              # Git ignore patterns
â”œâ”€â”€ package.json                            # Root workspace config
# (vercel.json removed; we use Render only)
```

## âš¡ CRITICAL RULES (READ ON EVERY PROMPT)

### 1. Workspace Context Awareness

**BEFORE making ANY change, identify the workspace:**

```
Frontend change? â†’ apps/frontend/
Backend change?  â†’ apps/backend/
API function?    â†’ api/
Root config?     â†’ root directory
Documentation?   â†’ top-level .md files
```

**NEVER:**
- Mix frontend and backend code
- Install backend deps in frontend (or vice versa)
- Hardcode URLs or secrets
- Modify deployment config without consulting this file

### 2. Development User (Auto-Seeded)

```javascript
// ALWAYS available (no need to create):
const DEV_USER = {
  email: 'dev@tripmaker.com',
  password: 'DevUser123!',
  id: 'dev-user-00000000-0000-0000-0000-000000000001'
};

// Backend: Auto-seeded in readUsers()
// Frontend: Use for all testing
// Render: Backend persists; dev user from seed when needed
```

### 3. API Integration Pattern

```javascript
// Frontend (apps/frontend/src/services/auth.js)
const API_BASE_URL = (import.meta.env.VITE_API_URL || '/api').replace(/\/$/, '');

// Always use this pattern:
fetch(`${API_BASE_URL}/login`, { ... })

// âŒ NEVER hardcode:
fetch('http://localhost:3000/login', { ... })
```

### 4. Environment Variables

```bash
# Frontend (.env.development)
VITE_API_URL=http://localhost:3000  # Local dev
VITE_API_URL=https://your-backend.onrender.com   # Production (Render backend URL)

# Backend (.env.development)
PORT=3000
JWT_SECRET=<auto-generated>          # Auto in dev, required in prod
CORS_ORIGINS=http://localhost:5173   # Comma-separated
```

### 5. Common Commands

```bash
# Development
npm run dev              # â­ Start both frontend & backend
npm run dev:frontend     # Frontend only (port 5173)
npm run dev:backend      # Backend only (port 3000)

# Testing
curl http://localhost:3000/health
open http://localhost:5173
open http://localhost:3000/api-docs

# Build & Deploy
npm run build            # Build frontend
git push origin main     # Deploy (Render auto-deploys on push if connected)
```

## ğŸ¨ FRONTEND PATTERNS (apps/frontend/)

### Core Stack
```
React 19.2.3 (functional components only)
Vite 7.3.1 (dev server + build)
React Router DOM 7.12.0 (client-side routing)
i18next 25.8.0 (6 languages supported)
```

### Coding Patterns

#### âœ… DO: Functional Components with Hooks

```jsx
import { useState, useEffect } from 'react';
import { useNavigate } from 'react-router-dom';
import { useTranslation } from 'react-i18next';

const Profile = () => {
  const [data, setData] = useState(null);
  const [loading, setLoading] = useState(true);
  const navigate = useNavigate();
  const { t } = useTranslation();
  
  useEffect(() => {
    // Fetch data on mount
    fetchData();
  }, []);
  
  const handleSubmit = async (e) => {
    e.preventDefault();
    // Handle form submission
  };
  
  return (
    <div>
      <h1>{t('profile.title')}</h1>
      {loading ? <p>{t('labels.loading')}</p> : <div>{data}</div>}
    </div>
  );
};

export default Profile;
```

#### âœ… DO: API Calls via Service Layer

```javascript
// In components:
import { loginUser } from '../services/auth';

const handleLogin = async (email, password) => {
  try {
    const result = await loginUser({ email, password });
    setStoredUser(result);
    navigate('/home');
  } catch (error) {
    setError(error.message);  // User-friendly message
  }
};

// âŒ DON'T: Direct fetch
fetch('http://localhost:3000/login', { ... })  // WRONG!
```

#### âœ… DO: i18n for All Text

```jsx
// Translation key
<h1>{t('auth.login.title')}</h1>

// With interpolation
<p>{t('auth.login.signedInAs', { email: user.email })}</p>

// âŒ DON'T: Hardcode text
<h1>Log in</h1>  // Won't translate!
```

#### âœ… DO: Protected Routes

```jsx
// App.jsx pattern
const RequireAuth = ({ children }) => {
  const user = getStoredUser();
  return user ? children : <Navigate to="/login" replace />;
};

<Route path="/profile" element={
  <RequireAuth>
    <Profile />
  </RequireAuth>
} />
```

### File Structure

```
src/
â”œâ”€â”€ pages/           # One file per route
â”‚   â”œâ”€â”€ Home.jsx     # /home route
â”‚   â”œâ”€â”€ Login.jsx    # / and /login routes
â”‚   â”œâ”€â”€ Register.jsx # /register route
â”‚   â””â”€â”€ Profile.jsx  # /profile route
â”œâ”€â”€ layouts/         # Wrapper components
â”‚   â”œâ”€â”€ AuthLayout.jsx   # For unauthenticated pages
â”‚   â””â”€â”€ SiteLayout.jsx   # For authenticated pages (nav, header)
â”œâ”€â”€ services/        # API communication layer
â”‚   â”œâ”€â”€ auth.js      # registerUser(), loginUser(), getStoredUser(), etc.
â”‚   â””â”€â”€ profile.js   # fetchProfile(), updateProfile(), saveProfile()
â”œâ”€â”€ App.jsx          # Routes definition
â”œâ”€â”€ main.jsx         # React mount point
â”œâ”€â”€ i18n.js          # Translation setup (6 languages)
â””â”€â”€ index.css        # Global styles
```

### State Management

```javascript
// Local Storage Keys
'waypoint.user'      // { id, email, token }
'waypoint.profile'   // { phone, country, language, currencyType }
'waypoint.language'  // Current UI language (en, hi, ml, ar, es, de)

// Component State (useState)
const [user, setUser] = useState(getStoredUser());
const [error, setError] = useState('');
const [loading, setLoading] = useState(false);

// Auth State Sync (custom event)
window.addEventListener('authchange', handleAuthChange);
window.dispatchEvent(new Event('authchange'));
```

## ğŸ”§ BACKEND PATTERNS (apps/backend/)

### Core Stack
```
Express.js 5.2.1 (web framework)
jsonwebtoken 9.0.2 (JWT auth)
Helmet 7.1.0 (security headers)
CORS 2.8.5 (cross-origin)
express-validator 7.0.1 (input validation)
swagger-ui-express 5.0.0 (API docs)
```

### Architecture Overview

```javascript
// apps/backend/server.js (SINGLE FILE, ~1200 lines)
//
// 1. Configuration (PORT, JWT_SECRET, CORS, etc.)
// 2. Swagger Setup (OpenAPI 3.0 spec)
// 3. Middleware (helmet, CORS, rate limiting, morgan)
// 4. Utility Functions (password hashing, JWT, user storage)
// 5. Auth Middleware (requireAuth, optionalAuth)
// 6. API Routes (/, /health, /register, /login, /profile/:id)
// 7. Error Handlers (404, global error handler)
// 8. Server Start (local only; on Render the process runs the same server)
```

### Adding New Endpoints

```javascript
// 1. Add Swagger docs ABOVE the route
/**
 * @swagger
 * /api/trips:
 *   post:
 *     tags: [Trips]
 *     summary: Create a new trip
 *     requestBody:
 *       required: true
 *       content:
 *         application/json:
 *           schema:
 *             type: object
 *             properties:
 *               name:
 *                 type: string
 *     responses:
 *       201:
 *         description: Trip created
 */
// 2. Add route with validation
app.post(
  '/trips',
  requireAuth,  // JWT required
  [
    body('name').notEmpty().withMessage('Trip name is required.')
  ],
  handleValidationErrors,
  async (req, res, next) => {
    try {
      const userId = req.user.id;  // From JWT
      const { name } = req.body;
      
      // Business logic here
      const trip = { id: crypto.randomUUID(), name, userId };
      
      res.status(201).json(trip);
    } catch (error) {
      next(error);  // Pass to error handler
    }
  }
);
```

### Authentication Middleware

```javascript
// Protected route (JWT required)
app.get('/protected', requireAuth, async (req, res) => {
  // req.user = { id, email } (from decoded JWT)
  const userId = req.user.id;
  res.json({ message: `Hello ${req.user.email}` });
});

// Public route with optional auth
app.get('/public', optionalAuth, async (req, res) => {
  // req.user exists if JWT provided, undefined otherwise
  if (req.user) {
    res.json({ message: `Hello ${req.user.email}` });
  } else {
    res.json({ message: 'Hello guest' });
  }
});
```

### Database Utilities (File-based)

```javascript
// Read all users
const users = await readUsers();  // Auto-seeds dev user

// Write users (uses queue to prevent race conditions)
await writeUsers(users);

// Hash password (scrypt + random salt)
const hash = hashPassword('MyPassword123!');
// Returns: "a1b2c3d4:e5f6g7h8..."

// Verify password
const isValid = verifyPassword('MyPassword123!', storedHash);

// Generate JWT token (7-day expiry)
const token = generateToken({ id: user.id, email: user.email });

// Normalize email (lowercase, trim)
const normalized = normalizeEmail('User@Example.com');
// Returns: "user@example.com"
```

### Rate Limiting Configuration

```javascript
// Existing limits:
const registerLimiter = createLimiter(
  15 * 60 * 1000,  // 15 minutes
  5,                // 5 requests max
  'Too many registration attempts.'
);

const loginLimiter = createLimiter(
  15 * 60 * 1000,  // 15 minutes
  10,               // 10 requests max
  'Too many login attempts.'
);

const generalLimiter = createLimiter(
  15 * 60 * 1000,  // 15 minutes
  100,              // 100 requests max
  'Too many requests.'
);

// Apply to routes:
app.post('/register', registerLimiter, ...);
app.post('/login', loginLimiter, ...);
app.use(generalLimiter);  // Apply to all
```

### API handlers (api/ â€“ used when adapting to serverless; production is Render Web Service running apps/backend)

```javascript
// api/user/profile.js example
const { readUsers, writeUsers, normalizeEmail } = require('../lib/db');

module.exports = async (req, res) => {
  // CORS (required for serverless)
  res.setHeader('Access-Control-Allow-Origin', '*');
  res.setHeader('Access-Control-Allow-Methods', 'GET, PUT, OPTIONS');
  res.setHeader('Access-Control-Allow-Headers', 'Content-Type, Authorization');
  
  if (req.method === 'OPTIONS') {
    return res.status(200).end();
  }
  
  try {
    const userId = req.query.id;
    const users = await readUsers();  // Auto-seeds dev user
    const user = users.find(u => u.id === userId);
    
    if (!user) {
      return res.status(404).json({ error: 'User not found.' });
    }
    
    if (req.method === 'GET') {
      return res.status(200).json(buildProfileResponse(user));
    }
    
    if (req.method === 'PUT') {
      // Update logic
      user.profile = { ...user.profile, ...req.body };
      await writeUsers(users);
      return res.status(200).json(buildProfileResponse(user));
    }
    
    return res.status(405).json({ error: 'Method not allowed' });
  } catch (error) {
    return res.status(500).json({ error: 'Operation failed' });
  }
};
```

## ğŸš€ DEPLOYMENT (Render)

### Render

```json
{
  "buildCommand": "cd apps/frontend && npm run build",
  "outputDirectory": "apps/frontend/dist",
  "rewrites": [
    {
      "source": "/profile/:id",
      "destination": "/api/user/profile?id=:id"
    },
    {
      "source": "/api/:path*",
      "destination": "/api/index"
    },
    {
      "source": "/(.*)",
      "destination": "/index.html"
    }
  ]
}
```

### Deployment Flow

```
1. git push origin main
   â†“
2. Render detects push (or manual deploy)
   â†“
3. Build Phase
   â”œâ”€ npm install (all workspaces)
   â”œâ”€ cd apps/frontend && npm run build
   â”‚  â””â”€ Output: apps/frontend/dist/
   â””â”€ Bundle api/ directory for serverless
   â†“
4. Deploy Phase
   â”œâ”€ Static files â†’ CDN (from apps/frontend/dist/)
   â”œâ”€ Serverless functions â†’ api/*.js
   â””â”€ Configure SPA rewrites on Render (see RENDER_SPA_RELOAD_FIX.md)
   â†“
5. Live URLs
   â”œâ”€ Frontend: https://tripmaker-63b1.onrender.com (or your Render URL)
   â”œâ”€ API: (your Render backend URL)
   â””â”€ See RENDER_DEPLOYMENT_GUIDE.md
```

### Required Environment Variables (Render Dashboard)

```bash
JWT_SECRET=<64-char-hex>  # Generate: node -e "console.log(crypto.randomBytes(32).toString('hex'))"
NODE_ENV=production
VITE_API_URL=/api
CORS_ORIGINS=https://your-frontend.onrender.com
```

### Post-Deployment Checklist

```bash
# 1. Health check
curl https://your-backend.onrender.com/health
# Expected: {"status":"ok"}

# 2. Frontend loads
open https://your-frontend.onrender.com
# Expected: Login page

# 3. Test login
curl -X POST https://your-backend.onrender.com/auth/login \
  -H "Content-Type: application/json" \
  -d '{"email":"dev@tripmaker.com","password":"DevUser123!"}'
# Expected: JWT token + user data

# 4. Check Render service logs
# Dashboard â†’ Deployments â†’ [Latest] â†’ Functions tab
```

## ğŸ”’ SECURITY BEST PRACTICES

### Frontend Security
- âœ… Never hardcode API URLs
- âœ… Use environment variables (VITE_API_URL)
- âœ… Store tokens in localStorage (already implemented)
- âœ… Clear tokens on logout
- âŒ Never store sensitive data in frontend code
- âŒ Never commit .env files with real credentials

### Backend Security
- âœ… JWT tokens expire after 7 days (configurable)
- âœ… Passwords hashed with scrypt + salt
- âœ… Rate limiting on all endpoints
- âœ… Helmet security headers
- âœ… CORS restricted to allowed origins
- âœ… Input validation on all endpoints
- âŒ Never log passwords or tokens
- âŒ Never return stack traces in production

### Environment Security
- âœ… `.env` files in .gitignore
- âœ… `.env.example` and `.env.development` safe to commit (no secrets). Backend loads `.env.development` when NODE_ENV=development; no `.env` required in backend folder.
- âœ… JWT_SECRET auto-generated in development
- âœ… JWT_SECRET required in production
- âŒ Never commit real JWT_SECRET
- âŒ Never use development secrets in production

## ğŸ“ GIT WORKFLOW

### Commit Messages
Use conventional commit format:
```bash
feat: add user profile editing
fix: resolve CORS issue in production
docs: update API documentation
style: format code with prettier
refactor: simplify authentication logic
test: add user registration tests
chore: update dependencies
```

### Branch Strategy
- **main**: Production-ready code (protected)
- **feature/***: New features
- **fix/***: Bug fixes
- **docs/***: Documentation updates

### Before Committing
1. Test locally: `npm run dev`
2. Build successfully: `npm run build`
3. No console errors
4. Code follows patterns in this file
5. Environment variables not hardcoded

## ğŸ§ª TESTING PATTERNS

### Manual Testing Checklist
- [ ] Backend health: `curl http://localhost:3000/health`
- [ ] Frontend loads: Visit http://localhost:5173
- [ ] Registration: Try creating a user
- [ ] Login: Try logging in
- [ ] API docs: Visit http://localhost:3000/api-docs
- [ ] CORS: Check browser console for CORS errors

### Testing New Features
1. **Backend API**: Test with curl or Swagger UI
2. **Frontend**: Test in browser with React DevTools
3. **Integration**: Test frontend â†’ backend flow
4. **Error Cases**: Test with invalid inputs
5. **Edge Cases**: Test boundary conditions

## ğŸ“š DOCUMENTATION

### When to Update Docs
- **README.md**: Project structure or overview changes
- **QUICK_START.md**: Setup process changes
- **RENDER_DEPLOYMENT_GUIDE.md**: Deployment process changes (Render only)
- **CONTRIBUTING.md**: Development workflow changes
- **APP_ARCHITECTURE.md**: Major configuration changes

### Documentation Standards
- Keep it concise and actionable
- Use examples and code blocks
- Update dates when modifying
- Test instructions before committing
- Link related documents

## ğŸ¯ COMMON TASKS

### 1. Adding a New React Page

```bash
# 1. Create page component
touch apps/frontend/src/pages/Trips.jsx

# 2. Write component (use existing pages as template)
# apps/frontend/src/pages/Trips.jsx
import { useTranslation } from 'react-i18next';

const Trips = () => {
  const { t } = useTranslation();
  return (
    <main className="trips-page">
      <h1>{t('trips.title')}</h1>
    </main>
  );
};

export default Trips;

# 3. Add route in App.jsx
import Trips from './pages/Trips';

<Route path="/trips" element={
  <RequireAuth><Trips /></RequireAuth>
} />

# 4. Add navigation link in SiteLayout.jsx
const navLinks = [
  { to: '/home', label: t('nav.home') },
  { to: '/trips', label: t('nav.trips') },
  { to: '/profile', label: t('nav.profile') }
];

# 5. Add translations to i18n.js
nav: {
  trips: "Trips"
},
trips: {
  title: "My Trips"
}

# 6. Test
npm run dev
open http://localhost:5173/trips
```

### 2. Adding a New API Endpoint

```javascript
// In apps/backend/server.js

// 1. Add Swagger documentation
/**
 * @swagger
 * /trips:
 *   get:
 *     tags: [Trips]
 *     summary: Get user's trips
 *     security:
 *       - bearerAuth: []
 *     responses:
 *       200:
 *         description: List of trips
 */

// 2. Add route with validation
app.get(
  '/trips',
  requireAuth,  // JWT required
  async (req, res, next) => {
    try {
      const userId = req.user.id;
      
      // Get trips for user
      const trips = []; // TODO: Implement trip storage
      
      res.status(200).json({ trips });
    } catch (error) {
      next(error);
    }
  }
);

// 3. Test locally
curl http://localhost:3000/trips \
  -H "Authorization: Bearer <token>"

// 4. API route (production: Render runs apps/backend; api/ is for reference/adaptation)
// api/trips.js
module.exports = async (req, res) => {
  // Same logic as above
};

// 5. Update Render config if needed (see RENDER_DEPLOYMENT_GUIDE.md)
// (No change needed, /api/:path* catches it)
```

### 3. Testing Authentication Flow

```bash
# Full flow test script
#!/bin/bash

# 1. Register (or use dev user)
echo "Logging in..."
RESPONSE=$(curl -s -X POST http://localhost:3000/login \
  -H "Content-Type: application/json" \
  -d '{"email":"dev@tripmaker.com","password":"DevUser123!"}')

echo "$RESPONSE" | jq .

# 2. Extract token
TOKEN=$(echo "$RESPONSE" | jq -r '.token')
USER_ID=$(echo "$RESPONSE" | jq -r '.id')

echo "Token: $TOKEN"
echo "User ID: $USER_ID"

# 3. Get profile
echo "Fetching profile..."
curl -s "http://localhost:3000/profile/$USER_ID" \
  -H "Authorization: Bearer $TOKEN" | jq .

# 4. Update profile
echo "Updating profile..."
curl -s -X PUT "http://localhost:3000/profile/$USER_ID" \
  -H "Authorization: Bearer $TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "phone": "+1 555 777 9999",
    "country": "Canada",
    "currencyType": "CAD"
  }' | jq .
```

### 4. Updating Dependencies

```bash
# Check for outdated packages
npm outdated

# Update all (root + workspaces)
npm update

# Update specific workspace
npm update --workspace=apps/frontend

# Update specific package
npm install react@latest --workspace=apps/frontend

# After updates, test
npm run dev
npm run build
```

### 5. Adding Translations

```javascript
// In apps/frontend/src/i18n.js

// Find the language you want to update (e.g., "en:")
const resources = {
  en: {
    translation: {
      // Add your keys here
      trips: {
        title: "My Trips",
        create: "Create Trip",
        empty: "No trips yet"
      }
    }
  },
  // Repeat for other languages (hi, ml, ar, es, de)
};

// Usage in components
const { t } = useTranslation();
<h1>{t('trips.title')}</h1>
<button>{t('trips.create')}</button>
```

## âš ï¸ COMMON MISTAKES & TROUBLESHOOTING

### âŒ DON'T DO THIS

```javascript
// 1. DON'T hardcode URLs
fetch('http://localhost:3000/api/users')
// âœ… DO use environment variables
fetch(`${import.meta.env.VITE_API_URL}/users`)

// 2. DON'T mix workspace dependencies
cd apps/frontend && npm install express
// âœ… DO install in correct workspace
npm install express --workspace=apps/backend

// 3. DON'T commit sensitive data
git add .env
// âœ… DO commit only .env.example

// 4. DON'T create class components
class MyComponent extends React.Component { }
// âœ… DO use functional components
const MyComponent = () => { }

// 5. DON'T skip error handling
const data = await fetch(url);
// âœ… DO wrap in try/catch
try {
  const data = await fetch(url);
} catch (error) {
  console.error(error);
}

// 6. DON'T hardcode text
<h1>Welcome</h1>
// âœ… DO use i18n
<h1>{t('welcome')}</h1>
```

### ğŸ› Troubleshooting Guide

#### Frontend Issues

**"Failed to fetch" error:**
```bash
# Check backend is running
curl http://localhost:3000/health

# Check CORS settings in backend
# Check VITE_API_URL in apps/frontend/.env.development
```

**"Module not found" error:**
```bash
# Reinstall dependencies
cd apps/frontend
rm -rf node_modules package-lock.json
npm install
```

**i18n keys not showing:**
```bash
# Check translation key exists in apps/frontend/src/i18n.js
# Verify no typos in key name
# Check correct language is active
```

#### Backend Issues

**"JWT_SECRET required" error:**
```bash
# Development: Auto-generated (ignore warning)
# Production: Set in Render Dashboard (backend service Environment)
```

**"User not found" after Render deployment:**
```bash
# Use dev user (auto-seeded):
# dev@tripmaker.com / DevUser123!
```

**Rate limit exceeded:**
```bash
# Wait 15 minutes
# Or restart local server to reset
```

#### Deployment Issues

**Render build fails:**
```bash
# Check Render service config (see RENDER_DEPLOYMENT_GUIDE.md)
# Test build locally: npm run build
# Check all dependencies are in package.json
```

**API endpoints return 404:**
```bash
# Check Render service env vars and start command
# Check Render service logs
```

**Frontend loads but API fails:**
```bash
# Check CORS_ORIGINS environment variable
# Verify VITE_API_URL is set to /api
# Check JWT_SECRET is set
```

## ğŸš¦ DECISION FLOWCHART

### "Where should this code go?"
```
Is it API logic?
  â”œâ”€ YES â†’ apps/backend/server.js
  â””â”€ NO â†“

Is it UI/React?
  â”œâ”€ YES â†’ apps/frontend/src/
  â”‚         â”œâ”€ Page? â†’ pages/
  â”‚         â”œâ”€ Layout? â†’ layouts/
  â”‚         â”œâ”€ API call? â†’ services/
  â”‚         â””â”€ Style? â†’ index.css
  â””â”€ NO â†“

Is it deployment config?
  â”œâ”€ YES â†’ Render Dashboard or .env.development (no .env required)
  â””â”€ NO â†“

Is it documentation?
  â”œâ”€ YES â†’ README.md, CONTRIBUTING.md, etc.
  â””â”€ NO â†“

Is it workspace config?
  â””â”€ YES â†’ Root package.json
```

### "How should I test this?"
```
Backend change?
  â””â”€ YES â†’ curl or Swagger UI (http://localhost:3000/api-docs)

Frontend change?
  â””â”€ YES â†’ Browser (http://localhost:5173) + React DevTools

Integration?
  â””â”€ YES â†’ Full user flow in browser

Deployment?
  â””â”€ YES â†’ Render preview deployment first
```

## ğŸ“ LEARNING RESOURCES

### Understanding the Stack
- **React**: https://react.dev
- **Vite**: https://vitejs.dev
- **Express**: https://expressjs.com
- **Render**: https://render.com/docs

### Project-Specific
- See `QUICK_START.md` for local setup
- See `RENDER_DEPLOYMENT_GUIDE.md` for deployment (Render only)
- See `CONTRIBUTING.md` for workflow
- See `DOCUMENTATION_INDEX.md` for documentation map

## ğŸ¯ CURSOR AI BEST PRACTICES

### On Every Prompt:

1. **Workspace Context**
   - Identify workspace: root, frontend, backend, or api
   - Never mix frontend and backend code

2. **Development User**
   - Always use `dev@tripmaker.com` for testing
   - Never create new test users unless explicitly asked

3. **Environment Variables**
   - Never hardcode URLs, tokens, or secrets
   - Always use `import.meta.env.VITE_*` (frontend)
   - Always use `process.env.*` (backend)

4. **Code Patterns**
   - Follow existing patterns in the codebase
   - Use functional components (React)
   - Use service layer for API calls (frontend)
   - Add Swagger docs for new endpoints (backend)
   - Use i18n for all user-facing text

5. **Error Handling**
   - Always wrap async operations in try/catch
   - Provide user-friendly error messages
   - Log errors for debugging

6. **Documentation**
   - Update relevant .md files when behavior changes
   - Keep this .cursorrules file current
   - Add comments for complex logic

7. **Testing**
   - Test locally before committing
   - Verify both frontend and backend work
   - Check deployed version after push

8. **Git Workflow**
   - Use conventional commit messages (feat, fix, docs, etc.)
   - Never commit .env files with secrets
   - Always test build before pushing

### Quick Decision Guide

```
Question: Where does this code go?
â”œâ”€ User interface/React? â†’ apps/frontend/src/
â”œâ”€ API logic? â†’ apps/backend/server.js (local)
â”‚             â†’ apps/backend (Render)
â”œâ”€ Configuration? â†’ Root (package.json), apps/backend, apps/frontend
â””â”€ Documentation? â†’ Root .md files

Question: How do I test this?
â”œâ”€ Backend API? â†’ curl or Swagger UI
â”œâ”€ Frontend UI? â†’ Browser + React DevTools
â”œâ”€ Full flow? â†’ Browser end-to-end
â””â”€ Deployment? â†’ Render dashboard

Question: Where is this documented?
â”œâ”€ Architecture? â†’ APP_ARCHITECTURE.md
â”œâ”€ API specs? â†’ API_REFERENCE.md
â”œâ”€ Testing? â†’ PROFILE_TESTING_RESULTS.md
â””â”€ Setup? â†’ QUICK_START.md
```

## ğŸ“ QUICK REFERENCE

```bash
# === DEVELOPMENT ===
npm run dev              # Start both frontend & backend
npm run dev:frontend     # Frontend only (port 5173)
npm run dev:backend      # Backend only (port 3000)

# === TESTING ===
# Backend health
curl http://localhost:3000/health

# Dev user login
curl -X POST http://localhost:3000/login \
  -H "Content-Type: application/json" \
  -d '{"email":"dev@tripmaker.com","password":"DevUser123!"}'

# Frontend
open http://localhost:5173

# API docs (local only)
open http://localhost:3000/api-docs

# === BUILDING ===
npm run build            # Build frontend

# === DEPLOYMENT ===
git add .
git commit -m "feat: add feature"
git push origin main     # Deploy (Render auto-deploys on push if connected)

# === RENDER URLS ===
# Frontend: your Render frontend URL
# API: your Render backend URL
```

## ğŸ“š Documentation Index

| File | Purpose | When to Read |
|------|---------|--------------|
| **`APP_ARCHITECTURE.md`** | Complete system design, data flow | Understanding architecture |
| **`API_REFERENCE.md`** | All API endpoints, formats | Building API features |
| **`PROFILE_TESTING_RESULTS.md`** | Testing workflows, results | Testing features |
| **`README.md`** | Project overview | First-time setup |
| **`QUICK_START.md`** | 2-minute local setup | Getting started |
| **`DEV_USER_GUIDE.md`** | Dev user documentation | Understanding test user |
| **`TEST_USER.md`** | Quick credentials reference | Testing auth |
| **`.cursorrules`** | This file - Cursor AI guide | On every prompt |

---

## ğŸ“ FINAL CHECKLIST FOR CURSOR AI

Before making changes:
- [ ] Read relevant documentation (see index above)
- [ ] Identify workspace (frontend/backend/api/root)
- [ ] Check existing patterns in similar files
- [ ] Understand current feature completely

While making changes:
- [ ] Follow existing code patterns
- [ ] Use environment variables (no hardcoding)
- [ ] Add error handling
- [ ] Use i18n for user-facing text
- [ ] Add comments for complex logic

After making changes:
- [ ] Test locally (`npm run dev`)
- [ ] Verify no console errors
- [ ] Update documentation if behavior changed
- [ ] Use conventional commit message
- [ ] Confirm deployment works (if pushing to main)

---

**Last Updated:** January 30, 2026  
**Version:** 2.0.0  
**Status:** Production-Ready âœ…  
**Maintained By:** Cursor AI + Development Team  
**Repository:** https://github.com/avinash6982/TripMakerWeb

---

> **Note for Cursor AI:** This file is your primary reference. Read the relevant sections on every prompt. When in doubt, consult `APP_ARCHITECTURE.md` for deep dives or `API_REFERENCE.md` for API specifics. Always keep this file and related documentation up to date.
