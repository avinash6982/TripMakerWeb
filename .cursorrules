# TripMaker Monorepo - Cursor AI Rules

## ğŸ—ï¸ PROJECT OVERVIEW

This is a **production-ready monorepo** for TripMaker, a travel planning platform.
- **Repository**: https://github.com/avinash6982/TripMakerWeb
- **Structure**: npm workspaces monorepo
- **Deployment**: Vercel (automatic on push to main)
- **Status**: Fully operational, all systems configured

### ğŸ¯ Development Test User (ALWAYS USE THIS)

**For ALL development, testing, and Cursor agent work, use:**
- **Email**: `dev@tripmaker.com`
- **Password**: `DevUser123!`
- **ID**: `dev-user-00000000-0000-0000-0000-000000000001`

This user is **auto-seeded** on every API call and available in both local and deployed environments.

## ğŸ“ MONOREPO STRUCTURE

```
TripMaker/                              # Root (monorepo workspace)
â”œâ”€â”€ apps/
â”‚   â”œâ”€â”€ frontend/                       # @tripmaker/frontend - React/Vite
â”‚   â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”‚   â”œâ”€â”€ pages/                 # React pages (Home, Login, Register, Profile)
â”‚   â”‚   â”‚   â”œâ”€â”€ layouts/               # Layout components (AuthLayout, SiteLayout)
â”‚   â”‚   â”‚   â”œâ”€â”€ services/              # API layer (auth.js, profile.js)
â”‚   â”‚   â”‚   â”œâ”€â”€ App.jsx                # Main app component
â”‚   â”‚   â”‚   â”œâ”€â”€ main.jsx               # Entry point
â”‚   â”‚   â”‚   â”œâ”€â”€ i18n.js                # Internationalization (6 languages)
â”‚   â”‚   â”‚   â””â”€â”€ index.css              # Global styles
â”‚   â”‚   â”œâ”€â”€ .env.development           # Dev config (tracked in git)
â”‚   â”‚   â”œâ”€â”€ .env.example               # Template
â”‚   â”‚   â”œâ”€â”€ vite.config.js             # Vite configuration
â”‚   â”‚   â””â”€â”€ package.json               # Frontend deps
â”‚   â”‚
â”‚   â””â”€â”€ backend/                        # @tripmaker/backend - Express.js
â”‚       â”œâ”€â”€ server.js                   # Main server (34KB, all routes & logic)
â”‚       â”œâ”€â”€ .env.development            # Dev config (tracked in git)
â”‚       â”œâ”€â”€ .env.example                # Template
â”‚       â”œâ”€â”€ FEATURES.md                 # Backend features list
â”‚       â””â”€â”€ package.json                # Backend deps
â”‚
â”œâ”€â”€ .cursorrules                        # THIS FILE
â”œâ”€â”€ .gitignore                          # Git ignore patterns
â”œâ”€â”€ .env.example                        # Root environment template
â”œâ”€â”€ package.json                        # Workspace config (npm workspaces)
â”œâ”€â”€ vercel.json                         # Vercel deployment config
â”‚
â””â”€â”€ Documentation/
    â”œâ”€â”€ README.md                       # Main overview
    â”œâ”€â”€ QUICK_START.md                  # Quick local setup (2 min)
    â”œâ”€â”€ VERCEL_DEPLOYMENT_GUIDE.md      # Deployment guide
    â”œâ”€â”€ CONTRIBUTING.md                 # Development guidelines
    â””â”€â”€ PROJECT_ANALYSIS.md             # Complete project analysis
```

## ğŸ¯ CRITICAL RULES - READ FIRST

### 1. Workspace Awareness
- **ALWAYS** identify which workspace you're working in: root, frontend, or backend
- **NEVER** mix frontend and backend code
- **ROOT changes** affect the entire monorepo (package.json, vercel.json, docs)
- **Frontend changes** go in `apps/frontend/`
- **Backend changes** go in `apps/backend/`

### 2. API Integration Pattern
```javascript
// Frontend API calls ALWAYS use environment-aware configuration
// Production: /api (relative path)
// Development: http://localhost:3000 (full URL)

// Example in apps/frontend/src/services/auth.js:
const API_BASE_URL = (import.meta.env.VITE_API_URL || "/api").replace(/\/$/, "");
```

### 3. Backend Routes Pattern
```javascript
// ALL backend routes are in server.js
// In production, routes are accessible at /api/* due to vercel.json routing
// Examples:
//   /register       (dev) â†’ /api/register      (prod)
//   /login          (dev) â†’ /api/login         (prod)
//   /health         (dev) â†’ /api/health        (prod)
```

### 4. Environment Variables
```bash
# Frontend vars MUST be prefixed with VITE_
VITE_API_URL=http://localhost:3000  # Dev
VITE_API_URL=/api                    # Prod

# Backend vars are standard
PORT=3000
JWT_SECRET=<auto-generated-in-dev>
CORS_ORIGINS=http://localhost:5173
```

### 5. Development Commands
```bash
npm run dev              # Start BOTH apps in parallel (use this!)
npm run dev:frontend     # Frontend only (port 5173)
npm run dev:backend      # Backend only (port 3000)
npm run build            # Build both apps
npm install              # Install all workspace dependencies
```

## ğŸ¨ FRONTEND GUIDELINES (apps/frontend/)

### Technology Stack
- **Framework**: React 19.2.3 (functional components, hooks only)
- **Build Tool**: Vite 7.3.1 (fast, modern)
- **Router**: React Router DOM 7.12.0
- **i18n**: react-i18next (6 languages: en, hi, ml, ar, es, de)

### Code Patterns

#### Components
```jsx
// âœ… CORRECT: Functional component with hooks
import { useState, useEffect } from 'react';

export const MyComponent = () => {
  const [data, setData] = useState(null);
  
  useEffect(() => {
    // Side effects here
  }, []);
  
  return <div>{data}</div>;
};

// âŒ WRONG: Class components
class MyComponent extends React.Component { }
```

#### API Calls
```javascript
// âœ… CORRECT: Use service layer from src/services/
import { registerUser, loginUser } from '../services/auth';

const handleRegister = async (email, password) => {
  try {
    const data = await registerUser({ email, password });
    // Handle success
  } catch (error) {
    // Handle error - error.message contains user-friendly message
  }
};

// âŒ WRONG: Direct fetch calls
fetch('http://localhost:3000/register', { ... })  // Hardcoded URL!
```

#### Routing
```jsx
// âœ… CORRECT: Use React Router
import { BrowserRouter, Routes, Route } from 'react-router-dom';

<Routes>
  <Route path="/" element={<Home />} />
  <Route path="/login" element={<Login />} />
</Routes>

// âŒ WRONG: Manual URL manipulation
window.location.href = '/login';
```

#### Internationalization
```jsx
// âœ… CORRECT: Use useTranslation hook
import { useTranslation } from 'react-i18next';

const MyComponent = () => {
  const { t } = useTranslation();
  return <h1>{t('welcome')}</h1>;
};

// âŒ WRONG: Hardcoded text
<h1>Welcome</h1>  // Won't translate!
```

### File Locations
- **Pages**: `src/pages/` (Home.jsx, Login.jsx, Register.jsx, Profile.jsx)
- **Layouts**: `src/layouts/` (AuthLayout.jsx, SiteLayout.jsx)
- **Services**: `src/services/` (auth.js, profile.js)
- **Main App**: `src/App.jsx`
- **Entry**: `src/main.jsx`
- **i18n Config**: `src/i18n.js`
- **Styles**: `src/index.css`

### Build Configuration
- **Config File**: `vite.config.js` (minimal, just React plugin)
- **Output**: `dist/` directory
- **Build**: Automatic via Vercel using `@vercel/static-build`
- **Dev Server**: Port 5173 (or next available)

## ğŸ”§ BACKEND GUIDELINES (apps/backend/)

### Technology Stack
- **Framework**: Express.js 5.2.1
- **Authentication**: JWT (jsonwebtoken 9.0.3)
- **Security**: Helmet 7.2.0, CORS 2.8.6, Rate Limiting
- **Validation**: express-validator 7.3.1
- **API Docs**: Swagger (swagger-ui-express, swagger-jsdoc)

### Architecture
```javascript
// ALL backend logic is in server.js
// Structure:
//   1. Configuration & Constants
//   2. Swagger Documentation
//   3. Middleware (helmet, CORS, rate limiting)
//   4. Utility Functions (password hashing, user storage)
//   5. Auth Middleware (requireAuth, optionalAuth)
//   6. API Endpoints (register, login, profile)
//   7. Error Handlers
//   8. Server Start
```

### Adding New Endpoints

#### 1. Add Swagger Documentation
```javascript
/**
 * @swagger
 * /api/new-endpoint:
 *   post:
 *     tags: [TagName]
 *     summary: Brief description
 *     description: Detailed description
 *     requestBody:
 *       required: true
 *       content:
 *         application/json:
 *           schema:
 *             type: object
 *             properties:
 *               field:
 *                 type: string
 *     responses:
 *       200:
 *         description: Success
 *       400:
 *         description: Validation error
 */
```

#### 2. Add Route Handler
```javascript
app.post(
  "/new-endpoint",
  optionalAuth,  // or requireAuth if auth needed
  [
    // Validation
    body("field")
      .notEmpty()
      .withMessage("Field is required."),
  ],
  handleValidationErrors,
  async (req, res, next) => {
    try {
      // Logic here
      res.status(200).json({ success: true });
    } catch (error) {
      next(error);  // Pass to error handler
    }
  }
);
```

### Authentication Pattern
```javascript
// For protected routes, use requireAuth
app.get("/protected", requireAuth, async (req, res) => {
  // req.user contains decoded JWT: { id, email }
  const userId = req.user.id;
});

// For optional auth, use optionalAuth
app.get("/public", optionalAuth, async (req, res) => {
  // req.user exists if token provided, undefined otherwise
});
```

### Rate Limiting
```javascript
// Current limits:
// - Registration: 5 requests per 15 minutes
// - Login: 10 requests per 15 minutes
// - General: 100 requests per 15 minutes

// To add custom limiter:
const customLimiter = createLimiter(
  15 * 60 * 1000,  // Window: 15 minutes
  50,               // Max requests
  "Custom error message"
);

app.post("/endpoint", customLimiter, handler);
```

### User Storage
```javascript
// Read users
const users = await readUsers();

// Write users (uses queue to prevent race conditions)
await writeUsers(users);

// Hash password
const hash = hashPassword(password);

// Verify password
const isValid = verifyPassword(password, storedHash);

// Generate JWT token
const token = generateToken(user);
```

### Environment Variables
```javascript
// Access via process.env
const port = Number(process.env.PORT) || 3000;
const jwtSecret = process.env.JWT_SECRET;  // Auto-generated in dev
const corsOrigins = process.env.CORS_ORIGINS;  // Comma-separated
```

## ğŸš€ DEPLOYMENT (Vercel)

### vercel.json Configuration
```json
{
  "version": 2,
  "builds": [
    {
      "src": "apps/frontend/package.json",
      "use": "@vercel/static-build",
      "config": { "distDir": "dist" }
    },
    {
      "src": "apps/backend/server.js",
      "use": "@vercel/node"
    }
  ],
  "routes": [
    { "src": "/api/(.*)", "dest": "apps/backend/server.js" },
    { "src": "/(.*)", "dest": "apps/frontend/dist/$1" }
  ]
}
```

### How Deployment Works
1. **Push to main** â†’ Vercel detects changes
2. **Frontend**: Built with Vite â†’ static files in `dist/`
3. **Backend**: Deployed as serverless functions
4. **Routing**: `/api/*` â†’ backend, everything else â†’ frontend
5. **Environment**: Variables from Vercel dashboard

### Required Vercel Environment Variables
```bash
JWT_SECRET=<64-char-random-string>      # Generate: node -e "console.log(require('crypto').randomBytes(32).toString('hex'))"
NODE_ENV=production
VITE_API_URL=/api
CORS_ORIGINS=https://your-app.vercel.app
```

### Deployment Checklist
- [ ] Environment variables set in Vercel dashboard
- [ ] Push to main branch
- [ ] Wait for build to complete
- [ ] Test /api/health endpoint
- [ ] Test frontend loads
- [ ] Update CORS_ORIGINS to actual Vercel URL
- [ ] Redeploy after CORS update

## ğŸ”’ SECURITY BEST PRACTICES

### Frontend Security
- âœ… Never hardcode API URLs
- âœ… Use environment variables (VITE_API_URL)
- âœ… Store tokens in localStorage (already implemented)
- âœ… Clear tokens on logout
- âŒ Never store sensitive data in frontend code
- âŒ Never commit .env files with real credentials

### Backend Security
- âœ… JWT tokens expire after 7 days (configurable)
- âœ… Passwords hashed with scrypt + salt
- âœ… Rate limiting on all endpoints
- âœ… Helmet security headers
- âœ… CORS restricted to allowed origins
- âœ… Input validation on all endpoints
- âŒ Never log passwords or tokens
- âŒ Never return stack traces in production

### Environment Security
- âœ… `.env` files in .gitignore
- âœ… `.env.example` and `.env.development` safe to commit (no secrets)
- âœ… JWT_SECRET auto-generated in development
- âœ… JWT_SECRET required in production
- âŒ Never commit real JWT_SECRET
- âŒ Never use development secrets in production

## ğŸ“ GIT WORKFLOW

### Commit Messages
Use conventional commit format:
```bash
feat: add user profile editing
fix: resolve CORS issue in production
docs: update API documentation
style: format code with prettier
refactor: simplify authentication logic
test: add user registration tests
chore: update dependencies
```

### Branch Strategy
- **main**: Production-ready code (protected)
- **feature/***: New features
- **fix/***: Bug fixes
- **docs/***: Documentation updates

### Before Committing
1. Test locally: `npm run dev`
2. Build successfully: `npm run build`
3. No console errors
4. Code follows patterns in this file
5. Environment variables not hardcoded

## ğŸ§ª TESTING PATTERNS

### Manual Testing Checklist
- [ ] Backend health: `curl http://localhost:3000/health`
- [ ] Frontend loads: Visit http://localhost:5173
- [ ] Registration: Try creating a user
- [ ] Login: Try logging in
- [ ] API docs: Visit http://localhost:3000/api-docs
- [ ] CORS: Check browser console for CORS errors

### Testing New Features
1. **Backend API**: Test with curl or Swagger UI
2. **Frontend**: Test in browser with React DevTools
3. **Integration**: Test frontend â†’ backend flow
4. **Error Cases**: Test with invalid inputs
5. **Edge Cases**: Test boundary conditions

## ğŸ“š DOCUMENTATION

### When to Update Docs
- **README.md**: Project structure or overview changes
- **QUICK_START.md**: Setup process changes
- **VERCEL_DEPLOYMENT_GUIDE.md**: Deployment process changes
- **CONTRIBUTING.md**: Development workflow changes
- **PROJECT_ANALYSIS.md**: Major configuration changes

### Documentation Standards
- Keep it concise and actionable
- Use examples and code blocks
- Update dates when modifying
- Test instructions before committing
- Link related documents

## ğŸ¯ COMMON TASKS

### Adding a New Page (Frontend)
1. Create component in `apps/frontend/src/pages/NewPage.jsx`
2. Add route in `apps/frontend/src/App.jsx`
3. Add navigation link if needed
4. Add translations to `apps/frontend/src/i18n.js`
5. Test navigation and rendering

### Adding a New API Endpoint (Backend)
1. Add Swagger docs above endpoint
2. Add route handler in `apps/backend/server.js`
3. Add validation with express-validator
4. Implement logic with error handling
5. Test with Swagger UI or curl
6. Document in FEATURES.md if significant

### Updating Dependencies
```bash
# Update all workspaces
npm update

# Update specific workspace
npm update --workspace=apps/frontend

# Check for outdated packages
npm outdated
```

### Debugging Issues
```bash
# Backend logs
# Check terminal output where npm run dev:backend is running

# Frontend logs
# Check browser console (F12)

# Vercel logs
# Dashboard â†’ Deployments â†’ [deployment] â†’ Functions tab

# Check environment variables
# Verify .env.development files exist and are correct
```

## âš ï¸ COMMON MISTAKES TO AVOID

### âŒ DON'T DO THIS:

1. **Hardcode URLs**
   ```javascript
   fetch('http://localhost:3000/api/users')  // âŒ WRONG
   // Use: const API_BASE_URL = import.meta.env.VITE_API_URL
   ```

2. **Mix workspace dependencies**
   ```bash
   cd apps/frontend && npm install express  # âŒ WRONG
   # Express belongs in backend only
   ```

3. **Commit sensitive data**
   ```bash
   git add .env  # âŒ WRONG
   # .env is gitignored, only commit .env.example
   ```

4. **Modify vercel.json without understanding**
   ```json
   // âŒ WRONG: Changing routes breaks API routing
   { "src": "/api/(.*)", "dest": "apps/frontend/dist/$1" }
   ```

5. **Run workspaces sequentially**
   ```bash
   npm run dev:backend && npm run dev:frontend  # âŒ WRONG
   # Use: npm run dev (runs in parallel with &)
   ```

6. **Create class components**
   ```jsx
   class MyComponent extends React.Component { }  // âŒ WRONG
   // Use: const MyComponent = () => { }
   ```

7. **Skip error handling**
   ```javascript
   const data = await fetch(url);  // âŒ WRONG (no try/catch)
   // Always wrap async calls in try/catch
   ```

## ğŸš¦ DECISION FLOWCHART

### "Where should this code go?"
```
Is it API logic?
  â”œâ”€ YES â†’ apps/backend/server.js
  â””â”€ NO â†“

Is it UI/React?
  â”œâ”€ YES â†’ apps/frontend/src/
  â”‚         â”œâ”€ Page? â†’ pages/
  â”‚         â”œâ”€ Layout? â†’ layouts/
  â”‚         â”œâ”€ API call? â†’ services/
  â”‚         â””â”€ Style? â†’ index.css
  â””â”€ NO â†“

Is it deployment config?
  â”œâ”€ YES â†’ vercel.json or .env.example
  â””â”€ NO â†“

Is it documentation?
  â”œâ”€ YES â†’ README.md, CONTRIBUTING.md, etc.
  â””â”€ NO â†“

Is it workspace config?
  â””â”€ YES â†’ Root package.json
```

### "How should I test this?"
```
Backend change?
  â””â”€ YES â†’ curl or Swagger UI (http://localhost:3000/api-docs)

Frontend change?
  â””â”€ YES â†’ Browser (http://localhost:5173) + React DevTools

Integration?
  â””â”€ YES â†’ Full user flow in browser

Deployment?
  â””â”€ YES â†’ Vercel preview deployment first
```

## ğŸ“ LEARNING RESOURCES

### Understanding the Stack
- **React**: https://react.dev
- **Vite**: https://vitejs.dev
- **Express**: https://expressjs.com
- **Vercel**: https://vercel.com/docs

### Project-Specific
- See `QUICK_START.md` for local setup
- See `VERCEL_DEPLOYMENT_GUIDE.md` for deployment
- See `CONTRIBUTING.md` for workflow
- See `PROJECT_ANALYSIS.md` for complete analysis

## ğŸ¯ CURSOR AI REMINDERS

When working on this project:

1. **ALWAYS** check which workspace (root/frontend/backend) before making changes
2. **NEVER** hardcode URLs, use environment variables
3. **ALWAYS** follow existing patterns (see examples in this file)
4. **NEVER** commit sensitive data (.env with real secrets)
5. **ALWAYS** test locally before committing
6. **ALWAYS** update documentation when changing behavior
7. **NEVER** skip error handling
8. **ALWAYS** use conventional commit messages
9. **NEVER** modify vercel.json without consulting this file
10. **ALWAYS** verify Vercel deployment after changes to config

## ğŸ“ QUICK REFERENCE

```bash
# Start development
npm run dev

# Test backend API
curl http://localhost:3000/health

# Test frontend
open http://localhost:5173

# API documentation
open http://localhost:3000/api-docs

# Build for production
npm run build

# Check git status
git status

# Commit changes
git add .
git commit -m "feat: description"
git push origin main
```

---

**Last Updated**: January 30, 2026
**Status**: Production Ready âœ…
**Repository**: https://github.com/avinash6982/TripMakerWeb
